#!/usr/bin/env bash
cd $HOME/bin
wget --quiet -N http://popcon.debian.org/by_vote.gz
#aptitude search --disable-columns -F "%p" "$@" | xargs -I FFFFF zgrep " FFFFF " $HOME/bin/by_vote.gz | sort -n

PACKAGES=$(aptitude search --disable-columns -F "%p" "$@")

if [ ${#PACKAGES} -le 0 ]
then
    exit
fi

SEARCH_WORD=
for p in ${PACKAGES:?No package found with \""$@"\"}
do
    SEARCH_WORD="${SEARCH_WORD}${p}\|"
done
SEARCH_WORD="^[[:digit:]]\+[[:space:]]\+\(${SEARCH_WORD%\\|}\)[[:space:]]\+"
#echo "${SEARCH_WORD}"

SORTED_PACKAGES=$(zgrep "${SEARCH_WORD}" $HOME/bin/by_vote.gz|sed 's/ \+/ /g'|cut -d ' ' -f 2)

TEXT=$(aptitude search "$@")
for p in ${SORTED_PACKAGES}
do
    grep "^... ${p}[[:space:]]" <<<"${TEXT}"
done
